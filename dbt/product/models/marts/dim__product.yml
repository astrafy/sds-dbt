version: 2

models:
  - name: dim__product
    description: "Dimension table for product details, enriched with currency text"
    columns:
      - name: product_id
        tests:
          - not_null        # Ensures no NULL values in the product_id column
          - unique          # Ensures no duplicate product_ids exist
    tests:
      - relationships:      # Ensures that product_id exists in staging_product
          column_name: product_id
          to: ref('int__product')
          field: product_id
unit_tests:
  - name: test_dim_product
    model: dim__product
    overrides:
      macros:
        # unit test this model in "full refresh" mode
        is_incremental: true 
    given:
      - input: ref('int__product')
        rows:
          - product_id: 1
            product_name: "Laptop"
            product_price: 1200.00
            ingested_date: 2025-03-04
      - input: this
        rows:
          - product_id: 1
            product_name: "Laptop"
            product_price: 1200.00
            ingested_date: 2025-03-05
    expect:
      rows: []
